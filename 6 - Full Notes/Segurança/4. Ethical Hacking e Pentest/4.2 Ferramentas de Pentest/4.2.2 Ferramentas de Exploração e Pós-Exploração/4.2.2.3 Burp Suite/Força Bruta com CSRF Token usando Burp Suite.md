2025-08-06 15:56

Status: #developed #segurança

Tags: [[CyberSecurity]] | [[Burp Suite]] | [[Pentest]]

----
# Introdução

Alguns sistemas implementam **tokens CSRF** como proteção, mas se esses tokens forem fracos ou previsíveis, podem ser quebrados via **ataque de brute force**. Com o **Burp Suite** é possível automatizar a enumeração de tokens CSRF válidos.

## Pré-requisitos

- **Burp Suite** (community ou pro)
- Alvo vulnerável (formulário com CSRF token fracos)
- Wordlist de tokens possíveis (opcional)

---
# Identificando o Token CSRF

1. **Analise a requisição no Burp Suite** (Proxy → HTTP History).
2. Verifique se há um parâmetro como:

```http
POST /change-email HTTP/1.1
Host: vulnerable.com

...
csrf_token=1a2b3c4d5e
```

3. Se o toke for **curto, numérico ou sequencial**, pode ser vulnerável a brute force.

---
# Configurando o Ataque no Burp Suite

## Passo 1: Captura a Requisição

1. Envie o formulário (ex.: mudança de e-mail) com o Burp Ligado.
2. No **Proxy → HTTP History**, clique com o botão direito e selecione "Send to Intruder".

## Passo 2: Configure o Intruder


1. Vá para a aba **Intruder → Positions** .
2. Selecione **"Sniper"** como tipo de ataque.
3. Marque o **token CSRF** como payload:

```http
csrf_toke=§1a2b3c4d5e§
```

## Passo 3: Defina o Payload

1. Na aba **Payloads**, escolha o tipo:
	- **Numbers** (se o toke for numérico).
	- **Custom list** (se tiver uma wordlist).
	- **Brute forcer** (para tentar combinações aleatórias).

## Passo 4: Filtre Respostas Válidas

1. Na aba **Options → Grep - Extract**, adicione uma string únicas de sucesso (ex.: `"E-mail alterado com sucesso"`).
2. Em **Options → Redirections**, marque **"Process cookies"** para manter a sessão.

## Passo 5: Execute o Ataque

1. Clique em **"Start attack"**.
2. O Burp testará cada token e destacará as respostas válidas.

---
# Exemplo Prático

## Pass 1: Capturando a Requisição

Ao usar o Burp Suite para capturar a requisição após uma tentativa de login com usuário e senha `test:test`, é possível observar o toke CSRF na requisição.

![[Pasted image 20250806161513.png]]

## Passo 2: Configurando o Intruder

Tendo a resposta do proxy, clique com o botão direito do mouse e selecione a segunda opção `Send to Intruder` para enviar a resposta para outra ferramenta do Burp:

![[Pasted image 20250806161552.png]]
 
Em seguida é selecionado o *Attack type* como `Pitchfork` e depois o a senha e o toke CSRF são marcados.

![[Pasted image 20250806162833.png]]

> O `username` foi alterado para "john" pois é um usuário conhecido e vulnerável.

## Passo 3: Definindo o Payload

Na seção `Payloads` do cabeçalho, em `Payload Options [Simple list]`, clique no botão `Load` e carregue um wordlist de senhas como `rockyou.txt` para a primeira posição do payload que é a senha.

![[aula3-img9.gif]]

Ainda em `Payloads`, selecione em `Payload set` o número 2 e em seguida, no `Payload type` clique em `Recursive grep`.

Acesse a seção `Options` do cabeçalho e em `Grep - Extract`, clique no botão `Add`. Irá abrir uma página chamada `Define extract grep item`, nela clique no botão `Fetch response` localizado no centro do canto direito.

Irá surgir o cabeçalho da página, junto com seu código HTML, na linha 48, selecione todo o token entre aspas, após `value=`:

```html
<input type="hidden" name="anticsrftoken" value="91c9c4ac84672bb668aa81b8e28f4948" class="form-control">
```

Em seguida, clique no botão `Ok` para carregar o payload:

![[aula3-img10.gif]]

Por fim, na seção `Resource Pool`, selecione o checkbox `Maximum concurrent requests` e na caixa de entrada à frente, preencha como número `1`:

![[aula3-img11.gif]]

## Passo 4: Iniciando e localizando o resultado

Clique no botão em laranja no canto superior direito da tela, chamado `Start attack` para iniciar a Força Bruta.

Localize a requisição em que se obtém Status `302` que indica a senha do usuário, que no caso do exemplo abaixo, é `johnpass`:

![[Pasted image 20250806162707.png]]

Descobrindo a senha do usuário John, você pode fazer o login na página.

![[aula3-img6.webp]]

---
# Mitigação e Prevenção

- **Use tokens longos e aleatórios** (ex: `uuid4()`).
- **Valide o token apenas uma vez** *(single-use)*.
- **Adicione rate limiting** nas requisições.

---
# Conclusão

Com o **Burp Suite**, é possível automatizar ataques de brute force em tokens CSRF fracos. Sistemas devem implementar **tokens robustos e mecanismos de defesa adicionais** para evitar exploração.