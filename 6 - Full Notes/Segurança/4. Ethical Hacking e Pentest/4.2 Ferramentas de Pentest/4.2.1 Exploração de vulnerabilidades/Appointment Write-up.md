2025-08-05 21:04

Status: #draft #segurança 

Tags: [[CyberSecurity]] | [[SQL Injection]] | [[Gobuster]]

----
# Introdução

O Appointment é uma caixa voltada principalmente para aplicações web. Mais especificamente, descobriremos como executar uma <font color="#ffc000"><strong>injeção de SQL</strong></font> em uma aplicação web habilitada para <font color="#ffc000"><strong>banco de dados SQL</strong></font>. Nosso alvo está executando um site com recursos de busca em um banco de dados back-end contendo itens pesquisáveis vulneráveis a esse tipo de ataque. Nem todos os itens nesse banco de dados devem ser vistos por qualquer usuário, portanto, diferentes privilégios no site concederão resultados de busca diferentes.

Hipoteticamente, um administrador do site pesquisará usuários, seus e-mails, informações de cobrança, endereço de entrega e outros. Em contraste, um usuário simples ou visitante não autenticado pode ter apenas permissão para pesquisar os produtos em promoção. Essas tabelas de informações serão separadas. No entanto, para um invasor com conhecimento sobre vulnerabilidades em aplicações web - especificamente injeção de SQL, neste caso - a separação entre essas tabelas não significará nada, pois ele poderá explorar a aplicação web para consultar diretamente qualquer tabela encontrada no banco de dados SQL do servidor web.

---
# SQL - *Structured Query Language*

![[Pasted image 20250805211126.png]]

Um excelente exemplo de como um Serviço SQL normalmente opera é o processo de login utilizado para qualquer usuário. Sempre que o usuário deseja efetuar login, o aplicativo web envia a entrada da página de login (combinação de nome de usuário/senha) para o Serviço SQL, comparando-a com as entradas armazenadas no banco de dados para aquele usuário específico.

Suponha que o nome de usuário e a senha especificados correspondam a qualquer entrada no banco de dados. Nesse caso, o Serviço SQL informará o aplicativo web, que, por sua vez, efetuará o login do usuário, concedendo-lhe acesso às partes restritas do site.

Após o login, o aplicativo web definirá para o usuário uma permissão especial na forma de um cookie ou token de autenticação que associa sua presença online à sua presença autenticada no site. Esse cookie é armazenado localmente, no armazenamento do navegador do usuário e no servidor web.

Posteriormente, se o usuário desejar pesquisar algo específico nos itens listados na página,
ele inserirá o nome do objeto em uma barra de pesquisa, o que acionará o mesmo Serviço SQL para executar a consulta SQL em nome do usuário. Suponha que exista uma entrada para o item pesquisado no banco de dados, normalmente em uma tabela diferente. Nesse caso, as informações associadas são recuperadas e enviadas ao aplicativo web para serem apresentadas ao usuário como imagens, texto, links e outros tipos, como comentários e avaliações.

---
# Como funciona o SQL?

![[Pasted image 20250805211403.png]]

O motivo pelo qual sites usam bancos de dados como MySQL, MariaDB ou outros tipos é que os dados que eles coletam ou servem, precisam ser armazenados em algum lugar.

Os dados podem ser nomes de usuário, senhas, postagens, mensagens ou conjuntos mais
sensíveis, como **[PII *(Personally Identifiable Information)](https://en.wikipedia.org/wiki/Personal_data)***, que são protegidos por leis internacionais de privacidade de dados. Qualquer empresa que desconsidere a proteção das PII de seus usuários é recebida com multas pesadas de reguladores internacionais e agências de privacidade de dados.

Injeção de SQL é uma forma comum de explorar páginas da web que usam **instruções SQL** que recuperam e armazenam dados de entrada do usuário. Se configurado incorretamente, pode-se usar esse ataque para explorar a conhecida vulnerabilidade de
Injeção de SQL, que é muito perigosa.

Existem muitas técnicas diferentes de proteção contra injeções de SQL, algumas delas sendo validação de entrada, consultas parametrizadas, procedimentos armazenados e
implementação de um WAF (Web Application Firewall) no perímetro da rede do servidor.

No entanto, é possível encontrar casos em que nenhuma dessas correções foi implementada, o que explica por que esse tipo de ataque é predominante, de acordo com a lista das 10 principais vulnerabilidades da web da ***[OWASP Top 10](https://owasp.org/www-project-top-ten)***.

![[Pasted image 20250805211911.png]]

---
# Verificação de Portas

Primeiro, realizamos uma varredura `nmap` para encontrar as portas abertas e disponíveis e seus serviços. Se nenhuma flag alternativa for especificada na sintaxe do comando, o `nmap` varrerá as 1000 portas TCP mais comuns em busca de serviços ativos.

Isso será útil em nosso caso.

Além disso, precisaremos de privilégios **super usuário** para executar o comando abaixo com as flags `-sC` ou `-sV`. 

Isso ocorre porque a varredura de scripts (`-sC`) e a detecção de versão (`-sV`) são consideradas métodos mais intrusivos de varredura do alvo. Isso resulta em uma maior probabilidade de ser detectado por um dispositivo de segurança de perímetro na
rede do alvo.

> [!abstract] Observação:
> - `-sC`: Executa uma varredura de script usando o conjunto padrão de scripts. É equivalente a `--script=default`. Alguns scripts nesta categoria são considerados intrusivos e não devem ser executados em uma rede de destino sem permissão.
> 
> - `-sV`: Habilita a detecção de versão, que detectará quais versões estão sendo executadas em qual porta.

![[Pasted image 20250805212351.png]]

A única porta aberta que detectamos é a porta `80/TCP`, que executa o servidor `Apache httpd versão 2.4.38`.

O Apache HTTP Server é um aplicativo gratuito e de código aberto que executa páginas da web em servidores físicos ou virtuais. É um dos servidores HTTP mais populares e geralmente roda em portas HTTP padrão, como
as portas `80 TCP`, `443 TCP` e, alternativamente, em portas HTTP, como `8080 TCP` ou `8000 TCP`. 

> [!info] O que é HTTP
> **HTTP *(Hypertext Transfer Protocol)*** ou Protocolo de Transferência de Hipertexto é um protocolo da camada de aplicação usado para transmitir documentos hipermídia, como HTML.

A varredura `nmap` fornece a versão exata do serviço do `Apache httpd`, que é `2.4.38`.

Normalmente, uma boa ideia seria pesquisar a versão do serviço em bancos de dados de vulnerabilidades populares online para verificar se existe alguma vulnerabilidade para a versão especificada. No entanto, em nosso caso, esta versão não contém nenhuma vulnerabilidade conhecida que possamos explorar.

---
# Enumeração de Diretórios

Para enumerar melhor o serviço em execução na porta 80, podemos navegar diretamente para o endereço IP do alvo a partir do nosso navegador.

![[Pasted image 20250805213116.png]]

>[!note] Observação:
>Começando abaixo, exploraremos o conceito de força bruta em diferentes diretórios para incluir em nossa fase de Enumeração, o que não nos ajudará a explorar o alvo e é considerado uma etapa opcional, mas importante. Esta seção é considerada opcional para o Nível 0, mas representa uma etapa valiosa no processo de avaliação.

Ao digitar o endereço IP do alvo no campo URL do nosso navegador, nos deparamos com um site contendo um formulário de login. Os formulários de login são usados para autenticar usuários e dar a eles acesso a partes restritas do site, dependendo do nível de privilégio associado ao nome de usuário inserido. Como não temos conhecimento de nenhuma credencial específica que possamos usar para fazer login, verificaremos se há outros diretórios ou páginas úteis para nós no processo de enumeração.

É sempre considerado uma boa prática enumerar completamente o alvo antes de atacarmos uma vulnerabilidade específica da qual temos conhecimento, como a vulnerabilidade de Injeção de SQL neste caso. Precisamos de uma visão geral para garantir que não estamos perdendo nada e caindo em uma armadilha, o que pode se tornar rapidamente frustrante.

Pense nos diretórios da web como "pastas da web" onde outros recursos e arquivos relevantes são armazenados e organizados, como outras páginas, formulários de login, formulários de login administrativo, imagens e armazenamento de arquivos de configuração, como CSS, JavaScript, PHP e muito mais. Alguns desses recursos são vinculados diretamente à página de destino do site. Páginas com as quais todos estamos acostumados, como `Home`, `About`, `Contact`, `Register` e as páginas de `Login` são consideradas diretórios web separados. Ao navegar para essas páginas, o endereço URL
na parte superior da janela do navegador mudará dependendo da nossa localização atual.

Por exemplo, se navegarmos da página inicial para a página de contato de um site, o URL mudará da seguinte forma:

-  `Home`

```http
https://www.example.com/home
```

-  `Contact`

```http
https://www.example.com/contact
```

Algumas páginas podem estar aninhadas em outras, o que significa que o diretório de uma página pode ser encontrado em um diretório maior contendo a página anterior. Vamos usar uma página "Esqueceu a Senha" como exemplo. Elas geralmente se encontram no diretório Login, pois você pode ser redirecionado para ele a partir do formulário de login caso tenha esquecido sua senha de usuário.

- `Log-in`

```http
https://www.example.com/login
```

- `Forgot-Password`

```http
https://www.example.com/login/forgot
```

No entanto, suponha que botões e links para os diretórios desejados não sejam fornecidos. Nesse caso, como os diretórios que procuramos contêm material sensível ou simplesmente recursos para o site carregar imagens e vídeos, podemos fornecer os nomes desses diretórios ou páginas da web no mesmo campo de URL do navegador para verificar se ele carrega algo.

Seu navegador, por si só, não bloqueará o acesso a esses diretórios simplesmente porque não há link ou botão na página da web para eles. Os administradores do site precisarão garantir que os diretórios que contêm informações sensíveis estejam devidamente protegidos para que os usuários não possam simplesmente navegar manualmente até eles.

Ao navegar pelos diretórios da web, o cliente HTTP, que é o seu navegador, se comunica com o servidor HTTP (neste caso, Apache 2.4.38) usando o protocolo HTTP, enviando uma solicitação HTTP (uma mensagem GET ou POST) que o servidor processará e retornará com uma resposta HTTP. As respostas HTTP contêm códigos de status, que detalham o status da interação entre a solicitação do cliente e como o servidor a tratou. Alguns dos códigos de status mais comuns para o protocolo HTTP são:

