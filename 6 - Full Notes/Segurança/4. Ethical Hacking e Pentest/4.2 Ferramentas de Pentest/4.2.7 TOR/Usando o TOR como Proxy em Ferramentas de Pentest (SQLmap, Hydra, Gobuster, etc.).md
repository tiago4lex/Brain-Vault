2025-08-12 14:42

Status: #developed #segurança 

Tags: [[CyberSecurity]] | [[TOR]] | [[Pentest]] | [[Hydra]] | [[SQLmap]] | [[Gobuster]] | [[Nuclei]]

----
# Introdução

O TOR pode ser usado como um proxy SOCKS para anonimizar ferramentas de segurança como SQLmap, Hydra e Gobuster. Isso é util para:

- Testes de invasão anônimos
- Evitar bloqueios por IP
- Bypass em redes censuradas

---
# Configurar o Proxy TOR

Antes de usar, verifique se o TOR está rodando e escutando na porta `9050` (padrão):

```bash
sudo systemctl start tor # inicia o serviço TOR
ss -tulno | grep 9050    # verifica se está escutando
```

Saída esperada:

```text
tcp   LISTEN 0      4096        127.0.0.1:9050      0.0.0.0:*
```

---
# Usando o TOR como Proxy em Ferramentas

## a) SQLmap via TOR

```bash
sqlmap -u "http://alvo.com/vuln.php?id=1" --proxy="socks5://127.0.0.1:9050" --random-agent --time-sec=5
```

**Flags Importantes**:

- `--proxy="socks5://127.0.0.1:9050"` → Usa o proxy TOR.
- `--random-agent` → Disfarça o User-Agent.
- `--time-sec=5` → Atraso entre requisições (evita detecção).

## c) Hydra (Brute Force) via TOR

```bash
hydra -l admin -P rockyou.txt alvo.com http-post-form "/login.php:user=^USER^pasword=^PASS^:F=Senha incorreta" -s 80 -e ns -t 4 -W 10 -f --proxxy soscks5://127.0.0.1:9050
```

**Flags Importantes:**

- `--proxy socks5://127.0.0.1:9050` → Usa o TOR.
- `-t 4` → Número de threads (evita muitas para não sobrecarregar o TOR).
- `-W 10` → Tempo de espera entre tentativas

## c) Gobuster (DirBusting) via TOR


```bash
gobuster dir -u http://alvo.com -w /user/share/wordlist/dirb/common.txt -t 20 --proxy "socks5://127.0.0.1:9050"
```

**Flags Importantes:**

- `--proxy "socks5://127.0.0.1:9050"` → Roteia via TOR.
- `-t 20` → Threads (reduz se o TOR estiver lento).

## d) Nmap (Scan Anônimo) via TOR

```bash
nmap -sT -Pn -n -T4 --proxy socks4://127.0.0.1:9050 http://alvo.com
```

**Flags Importantes:**

- `torsocks` → Encapsula qualquer aplicativo no TOR.
- `-sT` → Scan TCP (evite `-sS`, pois o TOR não suporta SYN scan).
- `-Pn` → Ignora descoberta de hosts (evita ICMP, que vaza IP real).

## e) Curl/Wget via TOR

```bash
curl --socks5-hostname 127.0.0.1:9050 http://alvo.com
wget -e use_proxy=yes -e http_proxy=socks5://127.0.0.1:9050 http://alvo.com
```

## f) Nuclei via TOR

### Uso Básico com `torsocks`

```bash
torsocks nuclei -u https://example.com -t exposures/
```

### Método Alternativo com Proxy SOCKS

```bash
nuclei -u https://target.com -proxy socks5://127.0.0.1:9050
```

**Mais exemplos:**

```bash
# Com proxy e rate limiting
nuclei -u https://target.com -proxy socks5://127.0.0.1:9050 -rate-limit 50 -silent

# Com timeout aumentado (Tor é mais lento)
nuclei -l targets.txt -proxy socks5://127.0.0.1:9050 -timeout 10 -silent
```

---
# Dicas para Evitar Problemas

## Problema 1: Conexão Lenta

- Reduza threads (`-t 2` no Hydra, `-t 10` no Gobuster).
- Use `--timeout=30` em ferramentas como SQLmap.

## Problemas 2: Vazamento de DNS

- Sempre use `-n` no Nmap (desativa resolução DNS).
- No Hydra, use `-4` (força IPv4)m evitando vazamentos.

## Problemas 3: IP Bloqueado pelo Alvo

- Mude o circuito do TOR manualmente

```bash
killall -HUP tor # gera um novo IP
```

---
# Configuração Avançada (Novo IP a cada X minutos)

Edite `/etc/tor/torrc` e adicione:

```bash
MaxCircuitDirtiness 60 # altera o IP a cada 1 minuto
```

Reinicie o TOR:

```bash
sudo systemctl restart tor
```

---
# Conclusão

Usar o TOR como proxy em ferramentas de teste permite:

✅ **Anonimato** (evita rastreamento).
✅ **Bypass em firewalls** (útil em redes corporativas).
✅ **Evitar bloqueios** (IPs dinâmicos do TOR).

>[!warning] Atenção!
>- O TOR não é 100% anônimo (evite enviar dados pessoais).
>- Algumas ferramentas (`nikto`, `metasploit`) podem vazar DNS.

