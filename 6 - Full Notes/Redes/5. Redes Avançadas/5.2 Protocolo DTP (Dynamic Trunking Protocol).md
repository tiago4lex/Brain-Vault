2025-06-03 23:59

Status: #developed #redes 

Tags: [[Redes de Computadores]] | [[DTP]] | [[Trunk]] | [[Camada 2 - Enlace]] | [[VLAN]] | [[Cisco]]

----
# O que é o DTP?

DTP *(Dynamic Trunking Protocol)* é um protocolo proprietário da Cisco usado entre switches para negociar dinamicamente se a interface entre eles será uma porta trunk ou access.

> [!important] Lembre-se
> O DTP facilita a configuração de VLANs em redes com múltiplos switches, reduzindo a necessidade de configuração manual das portas trunk.

----
# Conceito de Trunking

Antes de entender o DTP, é importante lembrar:

- **Porta access:** Transmite tráfego de apenas uma VLAN
- **Porta trunk:** Transmite tráfego de múltiplas VLANs simultaneamente, usando marcações (tags) com o protocolo 802.1Q

---
# Como o DTP Funciona?

Quando dois switches Cisco estão conectados e o DTP está ativado, eles trocam mensagens DTP para negociar o modo da porta. O objetivo é decidir se a conexão deve ser trunk ou access automaticamente.

## Troca de mensagens

- Os switches enviam **mensagens DTP** a cada 30 segundos pela porta conectada.
- As mensagens incluem **modo operacional, modo desejado e suporte trucking**.
- O switch decide se a porta será trunk ou access com base no **modo local e remoto**.

---
# Modos de Operação do DTP

| **Modo**            | **Descrição**                                                      |
| ------------------- | ------------------------------------------------------------------ |
| `access`            | Força a porta a ser modo access. DTP é desativado.                 |
| `trunk`             | Força a porta a ser trunk. Envia mensagens DTP.                    |
| `dynamic auto`      | Porta passiva. Espera o outro lado iniciar trunking.               |
| `dynamic desirable` | Porta ativa. Envia mensagens DTP para tentar formar trunk.         |
| `nonegotiate`       | Desativa DTP completamente. Usado quando o outro lado não é Cisco. |

## Tabela de interação


| **Local**         | **Remoto**        | **Resultado da Porta** |
| ----------------- | ----------------- | ---------------------- |
| trunk             | trunl             | trunk                  |
| trunk             | dynamic desirable | trunk                  |
| trunl             | dynamic auto      | trunk                  |
| dynamic desirable | dynamic desirable | trunk                  |
| dynamic desirable | dynamic auto      | trunk                  |
| dynamic auto      | dynamic auto      | **access**             |

---
# Exemplo de Configuração no Cisco CLI

## 1. Configurar uma porta como trunk estático

```bash
interface FastEthernet0/1
switchport mode trunk
```

## 2. Configurar como dynamic desirable (ativa DTP)

```bash
interface FastEthernet0/1
switchport mode dynamic desirable
```

## 3. Desativar DTP (modo seguro)

```bash
interface FastEthernet0/1
switchport nonegotiate
switchport mode trunk
```

> Importante: o `nonegotiate` **só pode ser usado com trunk**, e o outro lado **deve estar manualmente configurado como trunk também**.

---
# Boas práticas

- Desativar DTP em ambientes seguros para evitar ataques de trunking.
- Usar `switchport mode access` e `switchport nonegotiate` em portas de usuários final.
- Sempre verificar o **status da interface com:**

```bash
show interfaces switchport
```

---
# Riscos de Segurança

- O DTP pode ser explorado em ataques como [[Ataques VLAN Hopping]], se portas forem deixadas com DTP ativado e sem uso.
- Portanto, **desativar o DTP em portas não utilizadas ou de acesso é uma recomendação de segurança**.

---
# Conclusão

O DTP é uma ferramenta útil em redes Cisco para automatizar o trunking, mas exige cuidado. Ele deve ser bem compreendido e controlado, principalmente em ambientes maiores ou mais sensíveis à segurança.