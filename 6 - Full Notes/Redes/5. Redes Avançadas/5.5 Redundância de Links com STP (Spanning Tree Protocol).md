2025-06-04 14:15

Status: #developed #redes 

Tags: [[Redes de Computadores]] | [[STP]] | [[Redundância]] | [[Camada 2 - Enlace]] | [[Cisco]] | [[Disponibilidade]]

----
# O que é Redundância de Link?

Em redes de computadores, **redundância de links** significa <font color="#f79646"><strong>ter caminhos alternativos entre switches</strong></font> para garantir que, caso um cabo ou switch falhe, o tráfego possa seguir por outra rota.

- **Problemas:** Links redundantes causam **loops de camada 2**, que podem paralisar a rede.
- **Solução:** Utilizar o **protocolo STP** para evitar loops, mantendo a **resiliência da rede**.

---
# O que é STP *(Spanning Tree Protocol)*?

O **STP (IEEE 802.1D)** é um protocolo que identifica e **desativa automaticamente** links redundantes que possam criar loops em redes com switches. Ele garante que a rede tenha apenas **um caminho lógico ativo entre dois dispositivos**.

<font color="#ff0000"><strong>Se um link principal falhar</strong></font>, o STP <font color="#92d050"><strong>reativa automaticamente</strong></font> o caminho de backup.

---
# Como o STP Funciona?

## 1. Eleição do Switch Root *(Root Bridge)*

- Todos os switches trocam mensagens **BPDU *(Bridge Protocol Data Units)***.
- O switch com **menor Bridge ID (prioridade + MAC)** é escolhido como **Root Bridge**.

## 2. Escolha das Portas

STP define três tipos de porta:

| **Tipo de Porta**    | **Função**                       |
| -------------------- | -------------------------------- |
| Root Port (RP)       | Melhor caminho até o Root Bridge |
| Designated Port (DP) | Porta ativa no segmento de rede  |
| Blocked Port (BP)    | Porta que fica para evitar loops |

## 3. Estados da Porta STP

| **Estado** | **Descrição**                         |
| ---------- | ------------------------------------- |
| Blocking   | Não encaminha quadros                 |
| Listening  | Escuta BPDUs, sem aprender MACs       |
| Learning   | Aprende MACs, mas ainda não encaminha |
| Forwarding | Porta está ativa                      |
| Disabled   | Porta desativada manualmente          |

---
# Configuração Básica de STP (Cisco CLI)

## Verificar STP em uma VLAN

```bash
show spanning-tree vlan 1
```

## Configurar a prioridade de um switch para virar Root

```bash
configure terminal
spanning-tree vlan 1 priority 24576
```

## Forçar um switch a ser Root com o comando simplificado

```bash
spanning-tree vlan 1 root primary
```

---
# Exemplo Prático de Redundância com STP

Imagine três switches conectados entre si em um triângulo

![[Pasted image 20250604142819.png]]

Sem STP: cria-se um **loop**.

Com STP:
- SW1 é eleito o **Root Bridge**
- SW2 e SW3 configuram:
	- 1 porta como **Root Port**
	- 1 porta como **Designated Port**
	- 1 porta como **Blocked**

Se o link entre o SW1 e SW2 cair, o STP **desbloqueia automaticamente** o link SW2 <-> SW3 para restaurar a comunicação.

---
# Modos de STP

| **Modo**      | **Descrição**                              |
| ------------- | ------------------------------------------ |
| STP (802.1D)  | Original, mais lento (convergência ~50s)   |
| RSTP (802.1w) | Rápido, convergência em poucos segundos    |
| MSTP (802.1s) | Múltiplas instâncias para VLANs diferentes |
| PVST+         | Cisco: uma instância STP por VLAN          |

## Habilitar RSTP no Cisco

```bash
spanning-tree mode rapid-pvst
```

---
# Boas Práticas com STP

- Defina manualmente o **Root Bridge** para controle da topologia
- Use **RSTP** sempre que possível (mais rápido)
- Desative STP em portas de acesso, se necessário, com **PortFast**

```bash
interface FastEthernet0/1
spanning-tree port-fast
```

> Use apenas em portas conectadas a PCs, **não outros switches**.

---
# Conclusão

O ***Spanning Tree Protocol*** é essencial para **redes com redundância**, pois **impede loops** e garante a **alta disponibilidade** dos caminhos. Saber configurá-lo corretamente é fundamental para qualquer profissional de redes.